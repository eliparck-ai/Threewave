<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego de Retos Trio ‚Ä¢ v1.5</title>
<style>
  :root { --bg:#0b0c10; --card:#111318; --ink:#f3f5f7; --muted:#a9b2be; --accent:#7c4dff; }
  * { box-sizing:border-box }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial; background:var(--bg); color:var(--ink) }
  header { position:sticky; top:0; background:linear-gradient(180deg, rgba(11,12,16,.95), rgba(11,12,16,.75)); backdrop-filter:blur(6px); padding:12px 16px; border-bottom:1px solid #1d2026; display:flex; gap:8px; flex-wrap:wrap }
  .chip { padding:6px 10px; border-radius:999px; background:#1b1f26; border:1px solid #272b33; color:var(--muted); font-size:12px }
  .lvl { font-weight:700 }
  .wrap { max-width:980px; margin:0 auto; padding:16px }
  .card { background:#111318; border:1px solid #1d2026; border-radius:16px; padding:16px }
  h1 { font-size:18px; margin:0 }
  h2 { font-size:16px; margin:0 0 10px; color:var(--muted) }
  label { display:block; margin:10px 0 6px; color:var(--muted) }
  input, select, button { width:100%; padding:12px 14px; border-radius:12px; border:1px solid #282c34; background:#151820; color:var(--ink) }
  button { background:var(--accent); border-color:transparent; font-weight:700; cursor:pointer }
  button.secondary { background:#1d2230; border:1px solid #2e3444; font-weight:600 }
  .row { display:grid; grid-template-columns:1fr 1fr; gap:12px }
  .row3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px }
  .pill { border-radius:999px; padding:4px 10px; background:#1c2030; border:1px solid #2a3042; color:var(--muted); font-size:12px; display:inline-block; margin-right:6px }
  .challenge { margin-top:14px; padding:14px; background:#0f1117; border:1px dashed #2a3042; border-radius:12px }
  .gridPlayers { display:grid; grid-template-columns:repeat(2,1fr); gap:8px }
  .gridPlayers .card { padding:12px }
  .footer { color:var(--muted); font-size:12px; text-align:center; padding:14px }
  .toast { position:fixed; bottom:14px; left:50%; transform:translateX(-50%); background:#1d2230; border:1px solid #2e3444; color:#fff; padding:8px 12px; border-radius:10px; font-size:12px; display:none; z-index:10 }
</style>
</head>
<body>
  <header>
    <button id="decLvl" class="secondary" type="button">‚óÄÔ∏é</button>
    <div class="chip">Nivel: <span id="lvl" class="lvl">BAJO</span></div>
    <button id="incLvl" class="secondary" type="button">‚ñ∂Ô∏é</button>
    <div class="chip">Ronda: <span id="round">0</span>/30</div>
    <div class="chip">Fase: <span id="phase">1/3</span></div>
  </header>

  <div class="wrap">
    <div class="card" id="setup">
      <h1>Configurar partida</h1>
      <label>N√∫mero de jugadores</label>
      <select id="numPlayers">
        <option>2</option><option selected>3</option><option>4</option><option>5</option><option>6</option>
      </select>

      <div id="playersCfg" class="gridPlayers" style="margin-top:12px;"></div>

      <div class="row" style="margin-top:12px;">
        <button id="start" type="button">Iniciar (Nivel BAJO)</button>
        <button id="shuffle" class="secondary" type="button">Aleatorizar Nombres</button>
      </div>
      <p style="color:#a9b2be; margin-top:10px">Define <b>G√©nero</b> (H/M) y <b>Orientaci√≥n</b> (Hetero / Homosexual / Bisexual) para asignaciones correctas.</p>
    </div>

    <div class="card" id="game" style="display:none;">
      <div class="row3">
        <div>
          <h2>Participantes</h2>
          <div id="playersList"></div>
        </div>
        <div>
          <h2>Control</h2>
          <div class="row">
            <button id="next" class="big" type="button">üé≤ Sacar reto</button>
            <button id="skip" class="secondary" type="button">Saltar</button>
          </div>
          <div class="row" style="margin-top:10px;">
            <button id="reset" class="secondary" type="button">Reiniciar</button>
            <button id="backToSetup" class="secondary" type="button">Volver a Inicio</button>
          </div>
        </div>
        <div>
          <h2>Progreso</h2>
          <div class="pill">Nivel: <span id="lvl2">BAJO</span></div>
          <div class="pill">Ronda nivel: <span id="round2">0</span>/30</div>
          <div class="pill">Total retos: <span id="total">0</span></div>
        </div>
      </div>

      <div class="challenge" id="challengeBox" style="display:none;">
        <div style="color:#a9b2be">T√≠tulo</div>
        <div id="chTitle" class="title"></div>
        <div style="color:#a9b2be; margin-top:8px">Reto</div>
        <div id="chText" class="big"></div>
        <div id="chNote" style="color:#a9b2be; margin-top:8px"></div>
      </div>
    </div>
    <div class="footer">Juego de Retos ‚Ä¢ v1.5</div>
  </div>

  <div id="toast" class="toast"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const toast = (msg) => {
    const el = document.getElementById('toast');
    el.innerText = msg; el.style.display='block';
    setTimeout(()=>{ el.style.display='none'; }, 1200);
  };

  // ===== LISTA DE 90 RETOS =====
  // BAJO (30) ‚Üí suaves, coqueteo, contacto sobre ropa
  // MEDIO (30) ‚Üí m√°s atrevidos, ropa parcial, masajes, juegos
  // ALTO (30) ‚Üí osados, tr√≠os, poses sugerentes (no gr√°fico)
  const RETOS = [
    // ---------- BAJO (1-30) ----------
    { titulo:"Miradas", reto:"{{ACTOR}} sostiene la mirada de {{ALGUIEN}} durante 5 segundos con una sonrisa.", nota:"", nivel:"BAJO" },
    { titulo:"Elogio", reto:"{{ACTOR}} susurra un elogio al o√≠do de {{ALGUIEN}}.", nota:"", nivel:"BAJO" },
    { titulo:"Mano en la cintura", reto:"{{ACTOR}} coloca suavemente la mano en la cintura de {{ALGUIEN}} por 5 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Beso en la mejilla", reto:"{{ACTOR}} da un beso corto en la mejilla de {{ALGUIEN}}.", nota:"", nivel:"BAJO" },
    { titulo:"Abrazo lento", reto:"{{ACTOR}} abraza a {{ALGUIEN}} con calma por 5 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Cerca, muy cerca", reto:"{{ACTOR}} se acerca a pocos cent√≠metros del rostro de {{ALGUIEN}} sin besar.", nota:"", nivel:"BAJO" },
    { titulo:"Caricia de manos", reto:"{{ACTOR}} toma las manos de {{ALGUIEN}} y las acaricia 5 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Baile corto", reto:"{{ACTOR}} baila 10 seg pegado a {{ALGUIEN}} (sin m√∫sica si no hay).", nota:"", nivel:"BAJO" },
    { titulo:"Perfume", reto:"{{ACTOR}} huele el cuello de {{ALGUIEN}} y le dice a qu√© le recuerda.", nota:"", nivel:"BAJO" },
    { titulo:"Cabello", reto:"{{ACTOR}} acomoda el cabello de {{ALGUIEN}} suavemente.", nota:"", nivel:"BAJO" },
    { titulo:"Nariz con nariz", reto:"{{ACTOR}} roza la nariz con la de {{ALGUIEN}} (esquimal) 3 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Mano en espalda", reto:"{{ACTOR}} posa la mano en la parte baja de la espalda de {{ALGUIEN}} 5 seg.", nota:"Sobre la ropa.", nivel:"BAJO" },
    { titulo:"Sillita breve", reto:"{{ACTOR}} se sienta a un lado de {{ALGUIEN}} muy pegado 5 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Pesta√±eo", reto:"{{ACTOR}} le gui√±a un ojo a {{ALGUIEN}} y le dice un secreto al o√≠do.", nota:"", nivel:"BAJO" },
    { titulo:"Risa compartida", reto:"{{ACTOR}} hace re√≠r a {{ALGUIEN}} con una frase p√≠cara.", nota:"", nivel:"BAJO" },
    { titulo:"Danza de manos", reto:"{{ACTOR}} entrelaza los dedos con {{ALGUIEN}} y hace un giro suave.", nota:"", nivel:"BAJO" },
    { titulo:"Beso al aire", reto:"{{ACTOR}} lanza un beso a pocos cent√≠metros de los labios de {{ALGUIEN}}.", nota:"Sin tocar.", nivel:"BAJO" },
    { titulo:"Paseo guiado", reto:"{{ACTOR}} toma de la mano a {{ALGUIEN}} y da 3 pasos con √©l/ella.", nota:"", nivel:"BAJO" },
    { titulo:"Hombro a hombro", reto:"{{ACTOR}} apoya su hombro con el de {{ALGUIEN}} 5 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Ronda de cumplidos", reto:"{{ACTOR}} dice dos cualidades que nota en {{ALGUIEN}}.", nota:"", nivel:"BAJO" },
    { titulo:"Beso en la mano", reto:"{{ACTOR}} besa la mano de {{ALGUIEN}} con calma.", nota:"", nivel:"BAJO" },
    { titulo:"Rostro cerca", reto:"{{ACTOR}} acerca su frente a la de {{ALGUIEN}} 3 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Cosquillas suaves", reto:"{{ACTOR}} hace cosquillas suaves a {{ALGUIEN}} (2 seg).", nota:"Consentidas.", nivel:"BAJO" },
    { titulo:"Beso en la sien", reto:"{{ACTOR}} roza la sien de {{ALGUIEN}} con un beso suave.", nota:"", nivel:"BAJO" },
    { titulo:"Dibujo en la piel", reto:"{{ACTOR}} dibuja una figura en el antebrazo de {{ALGUIEN}} con un dedo.", nota:"", nivel:"BAJO" },
    { titulo:"Sombra de labios", reto:"{{ACTOR}} acerca sus labios al cuello de {{ALGUIEN}} sin tocar por 3 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Pausa y mirada", reto:"{{ACTOR}} se queda en silencio y mira a {{ALGUIEN}} con complicidad 5 seg.", nota:"", nivel:"BAJO" },
    { titulo:"Beso en la frente", reto:"{{ACTOR}} da un beso suave en la frente de {{ALGUIEN}}.", nota:"", nivel:"BAJO" },
    { titulo:"Giro dulce", reto:"{{ACTOR}} toma a {{ALGUIEN}} de la cintura y lo/la gira lentamente.", nota:"", nivel:"BAJO" },
    { titulo:"Brindis", reto:"{{ACTOR}} brinda con {{ALGUIEN}} y le dice lo que m√°s le gusta de √©l/ella.", nota:"", nivel:"BAJO" },

    // ---------- MEDIO (31-60) ----------
    { titulo:"Beso en cuello", reto:"{{ACTOR}} besa el cuello de {{ALGUIEN}} por 5 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Mordidita leve", reto:"{{ACTOR}} da una mordidita muy suave en el l√≥bulo de {{ALGUIEN}}.", nota:"", nivel:"MEDIO" },
    { titulo:"Caricia debajo del pelo", reto:"{{ACTOR}} desliza su mano detr√°s de la nuca de {{ALGUIEN}}.", nota:"", nivel:"MEDIO" },
    { titulo:"Mano en muslo (ropa)", reto:"{{ACTOR}} posa su mano en el muslo de {{ALGUIEN}} 5 seg (sobre ropa).", nota:"", nivel:"MEDIO" },
    { titulo:"Abrazo por detr√°s", reto:"{{ACTOR}} abraza por la espalda a {{ALGUIEN}} 5 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Baile lento pegado", reto:"{{ACTOR}} baila pegado con {{ALGUIEN}} por 20 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Reto del perfume", reto:"{{ACTOR}} deja un beso en el lugar donde {{ALGUIEN}} indique (no √≠ntimo).", nota:"", nivel:"MEDIO" },
    { titulo:"Mano guiada", reto:"{{ALGUIEN}} gu√≠a la mano de {{ACTOR}} por su espalda (sobre ropa) 5 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Desabrochar accesorio", reto:"{{ACTOR}} quita un accesorio o abre un bot√≥n superficial de {{ALGUIEN}}.", nota:"Sin descubrir zonas √≠ntimas.", nivel:"MEDIO" },
    { titulo:"Sentarse en regazo", reto:"{{ACTOR}} se sienta en el regazo de {{ALGUIEN}} 10 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Beso en comisura", reto:"{{ACTOR}} besa la comisura de los labios de {{ALGUIEN}}.", nota:"", nivel:"MEDIO" },
    { titulo:"Masaje cuello", reto:"{{ACTOR}} da un mini masaje de cuello a {{ALGUIEN}} 15 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Rodear cintura", reto:"{{ACTOR}} rodea con ambos brazos la cintura de {{ALGUIEN}} 5 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Caricia lateral", reto:"{{ACTOR}} pasa su mano por el costado del torso de {{ALGUIEN}} lentamente (ropa).", nota:"", nivel:"MEDIO" },
    { titulo:"Beso en hombro", reto:"{{ACTOR}} besa uno de los hombros de {{ALGUIEN}}.", nota:"", nivel:"MEDIO" },
    { titulo:"Susurro travieso", reto:"{{ACTOR}} dice a {{ALGUIEN}} una fantas√≠a breve al o√≠do.", nota:"", nivel:"MEDIO" },
    { titulo:"Mano en cintura guiada", reto:"{{ALGUIEN}} coloca la mano de {{ACTOR}} en su cintura y no la suelta por 5 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Reto del giro", reto:"{{ACTOR}} gira a {{ALGUIEN}} tom√°ndolo/a de las manos y lo acerca a su pecho.", nota:"", nivel:"MEDIO" },
    { titulo:"Caricia en cadera (ropa)", reto:"{{ACTOR}} acaricia la cadera de {{ALGUIEN}} 5 seg (sobre ropa).", nota:"", nivel:"MEDIO" },
    { titulo:"Beso lento en mejilla", reto:"{{ACTOR}} da un beso lento (2 seg) en la mejilla de {{ALGUIEN}}.", nota:"", nivel:"MEDIO" },
    { titulo:"Apoyar frente", reto:"{{ACTOR}} apoya su frente en la de {{ALGUIEN}} y respira juntos 5 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Cruzar miradas cerca", reto:"{{ACTOR}} acerca sus labios a 1 cm de los de {{ALGUIEN}} sin besar 3 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Abriendo camino", reto:"{{ACTOR}} descubre un hombro de {{ALGUIEN}} y lo besa una vez.", nota:"", nivel:"MEDIO" },
    { titulo:"Caricia en antebrazo", reto:"{{ACTOR}} recorre el antebrazo de {{ALGUIEN}} con la yema de los dedos.", nota:"", nivel:"MEDIO" },
    { titulo:"Dobles manos", reto:"{{ACTOR}} toma ambas manos de {{ALGUIEN}} y las lleva a su pecho (sobre ropa).", nota:"", nivel:"MEDIO" },
    { titulo:"Sentarse juntos", reto:"{{ACTOR}} se sienta pegado a {{ALGUIEN}} y apoya su cabeza en su hombro 5 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Beso esquivo", reto:"{{ACTOR}} intenta dar un beso en labios a {{ALGUIEN}} que se deja a la tercera.", nota:"", nivel:"MEDIO" },
    { titulo:"Marcar ritmo", reto:"{{ACTOR}} gu√≠a a {{ALGUIEN}} con la mano en la espalda baja mientras caminan 5 seg.", nota:"", nivel:"MEDIO" },
    { titulo:"Caricia detr√°s de rodilla", reto:"{{ACTOR}} acaricia delicadamente detr√°s de la rodilla de {{ALGUIEN}} (ropa).", nota:"", nivel:"MEDIO" },
    { titulo:"Juego del eco", reto:"{{ACTOR}} repite al o√≠do de {{ALGUIEN}} lo que quiera o√≠r, muy cerca.", nota:"", nivel:"MEDIO" },

    // ---------- ALTO (61-90) ----------
    { titulo:"Beso en labios", reto:"{{ACTOR}} da un beso breve en los labios de {{ALGUIEN}}.", nota:"Consentimiento expl√≠cito.", nivel:"ALTO" },
    { titulo:"Sillita firme", reto:"{{ACTOR}} se sienta en el regazo de {{ALGUIEN}} mir√°ndolo a los ojos 10 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Cuello lento", reto:"{{ACTOR}} besa y recorre el cuello de {{ALGUIEN}} lentamente 7 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Mano guiada atrevida", reto:"{{ALGUIEN}} gu√≠a la mano de {{ACTOR}} por su costado hasta la cadera (ropa).", nota:"", nivel:"ALTO" },
    { titulo:"Labio mordido", reto:"{{ACTOR}} muerde suavemente el labio inferior de {{ALGUIEN}}.", nota:"", nivel:"ALTO" },
    { titulo:"Baile muy pegado", reto:"{{ACTOR}} baila con {{ALGUIEN}} de forma muy pegada 20 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Besos en hombros", reto:"{{ACTOR}} besa ambos hombros de {{ALGUIEN}} lentamente.", nota:"", nivel:"ALTO" },
    { titulo:"Espalda descubierta", reto:"{{ACTOR}} descubre parte de la espalda de {{ALGUIEN}} y la recorre con besos.", nota:"", nivel:"ALTO" },
    { titulo:"Sugerencia al o√≠do", reto:"{{ACTOR}} describe a {{ALGUIEN}} c√≥mo le gustar√≠a que lo/la besen luego.", nota:"", nivel:"ALTO" },
    { titulo:"Juego de rodillas", reto:"{{ACTOR}} apoya una rodilla entre las piernas de {{ALGUIEN}} (ropa) por 5 seg.", nota:"Sin presi√≥n.", nivel:"ALTO" },
    { titulo:"Rostro entre manos", reto:"{{ACTOR}} sujeta el rostro de {{ALGUIEN}} con ambas manos y le da un beso corto.", nota:"", nivel:"ALTO" },
    { titulo:"Sentadilla juntos", reto:"{{ACTOR}} y {{ALGUIEN}} bajan juntos hasta quedar muy cerca, y suben.", nota:"Contacto suave.", nivel:"ALTO" },
    { titulo:"Beso prolongado", reto:"{{ACTOR}} da un beso prolongado a {{ALGUIEN}} (3‚Äì5 seg).", nota:"", nivel:"ALTO" },
    { titulo:"Manos por la cintura", reto:"{{ACTOR}} rodea la cintura de {{ALGUIEN}} y la acerca a su cuerpo 5 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Doble abrazo", reto:"{{ACTOR}} abraza a {{ALGUIEN}} por la espalda y besa su cuello.", nota:"", nivel:"ALTO" },
    { titulo:"Silla invertida", reto:"{{ACTOR}} se sienta de espaldas a {{ALGUIEN}} entre sus piernas 10 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Beso de esquinas", reto:"{{ACTOR}} besa cuatro puntos del rostro de {{ALGUIEN}} (frente, mejillas, labios).", nota:"", nivel:"ALTO" },
    { titulo:"Lento y cerca", reto:"{{ACTOR}} roza su nariz con la de {{ALGUIEN}} y luego besa su comisura.", nota:"", nivel:"ALTO" },
    { titulo:"Caricia en cadera", reto:"{{ACTOR}} sujeta las caderas de {{ALGUIEN}} y marca un ritmo suave 10 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Pecho con pecho", reto:"{{ACTOR}} acerca su pecho al de {{ALGUIEN}} y respiran juntos 5 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Beso con pausa", reto:"{{ACTOR}} besa a {{ALGUIEN}}, se detiene 1 seg, y vuelve a besar.", nota:"", nivel:"ALTO" },
    { titulo:"Beso sorpresa", reto:"{{ACTOR}} pide a {{ALGUIEN}} cerrar los ojos y le da un beso suave.", nota:"", nivel:"ALTO" },
    { titulo:"Caricia de muslo", reto:"{{ACTOR}} acaricia por fuera el muslo de {{ALGUIEN}} con lentitud 5 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Giro a tres", reto:"{{ACTOR}} elige a {{ALGUIEN}} y los gu√≠a para colocarse juntitos (a tres) 10 seg.", nota:"Contacto suave, consentido.", nivel:"ALTO" },
    { titulo:"Beso alternado", reto:"{{ACTOR}} da un beso a {{ALGUIEN}} y luego mira al tercero con picard√≠a.", nota:"Invita al juego.", nivel:"ALTO" },
    { titulo:"Beso mariposa", reto:"{{ACTOR}} roza con sus pesta√±as la mejilla de {{ALGUIEN}} y le da un beso.", nota:"", nivel:"ALTO" },
    { titulo:"Cruce de manos", reto:"{{ACTOR}} toma una mano de {{ALGUIEN}} y la lleva a su pecho (ropa) 5 seg.", nota:"", nivel:"ALTO" },
    { titulo:"Vuelta pegada", reto:"{{ACTOR}} toma de la cintura a {{ALGUIEN}} y lo hace girar muy pegado.", nota:"", nivel:"ALTO" },
    { titulo:"Beso final", reto:"{{ACTOR}} da un beso intenso pero corto a {{ALGUIEN}}.", nota:"Cierre con consentimiento.", nivel:"ALTO" },
    { titulo:"Foto mental", reto:"{{ACTOR}} le dice a {{ALGUIEN}} qu√© imagen se lleva de este momento.", nota:"", nivel:"ALTO" }
  ];

  const LEVELS = ["BAJO","MEDIO","ALTO"];
  const $ = (id) => document.getElementById(id);

  let state = {
    levelIndex:0, roundInLevel:0, totalRounds:0,
    players:[], // {name, gender:'M'|'F', orient:'hetero'|'homo'|'bi'}
    usedByLevel:{BAJO:[],MEDIO:[],ALTO:[]}
  };

  const currentLevel = () => LEVELS[state.levelIndex];

  function setLevel(idx){
    state.levelIndex = Math.max(0, Math.min(2, idx));
    $("lvl").textContent = currentLevel();
    $("lvl2").textContent = currentLevel();
    $("phase").textContent = (state.levelIndex+1)+"/3";
  }
  function nextRoundCounters(){
    state.roundInLevel++; state.totalRounds++;
    $("round").textContent = state.roundInLevel;
    $("round2").textContent = state.roundInLevel;
    $("total").textContent = state.totalRounds;
    if(state.roundInLevel>=30 && state.levelIndex<2){
      state.roundInLevel=0; setLevel(state.levelIndex+1); toast("‚§¥Ô∏è Cambio de nivel");
    }
  }
  function resetGame(){
    state.roundInLevel=0; state.totalRounds=0;
    state.usedByLevel={BAJO:[],MEDIO:[],ALTO:[]};
    setLevel(0); $("round").textContent=0; $("round2").textContent=0; $("total").textContent=0;
    $("challengeBox").style.display="none";
  }

  // === UI de jugadores (incluye ORIENTACI√ìN) ===
  function renderPlayersConfigurator(){
    const n = parseInt($("numPlayers").value,10);
    const root = $("playersCfg"); root.innerHTML="";
    const defaults = ["Ella","Pareja","Bull","Amiga","Amigo","Invitado"];
    for(let i=0;i<n;i++){
      const c = document.createElement("div"); c.className="card";
      c.innerHTML = `
        <label>Jugador ${i+1}</label>
        <input type="text" id="pname_${i}" value="${defaults[i%defaults.length]}">
        <label>G√©nero</label>
        <select id="pg_${i}">
          <option value="M">Hombre</option>
          <option value="F" ${i===0?"selected":""}>Mujer</option>
        </select>
        <label>Orientaci√≥n</label>
        <select id="po_${i}">
          <option value="hetero">Hetero</option>
          <option value="homo">Homosexual</option>
          <option value="bi">Bisexual</option>
        </select>
      `;
      root.appendChild(c);
    }
  }

  function collectPlayers(){
    const n = parseInt($("numPlayers").value,10);
    state.players = [];
    for(let i=0;i<n;i++){
      const name = $("pname_"+i).value.trim() || ("J"+(i+1));
      const gender = $("pg_"+i).value;
      const orient = $("po_"+i).value;
      state.players.push({ name, gender, orient });
    }
  }

  function listPlayers(){
    const root=$("playersList"); root.innerHTML="";
    const ul=document.createElement("ul"); ul.style.margin="0"; ul.style.paddingLeft="18px";
    const gtxt = g => g==="M"?"Hombre":"Mujer";
    const otxt = o => o==="hetero"?"Hetero":o==="homo"?"Homosexual":"Bisexual";
    state.players.forEach(p=>{
      const li=document.createElement("li");
      li.textContent=`${p.name} ‚Ä¢ ${gtxt(p.gender)} ‚Ä¢ ${otxt(p.orient)}`;
      ul.appendChild(li);
    });
    root.appendChild(ul);
  }

  // === Compatibilidad seg√∫n g√©nero + orientaci√≥n del ACTOR ===
  // Regla especial: si actor es "homo" y no hay otro homo del mismo sexo, se comporta como "hetero".
  function pickPartnerForActor(actor){
    let pool = [];

    if (actor.orient === "hetero") {
      // Hetero: sexo opuesto
      const targetGenders = actor.gender === "M" ? ["F"] : ["M"];
      pool = state.players.filter(p => targetGenders.includes(p.gender) && p.name !== actor.name);

    } else if (actor.orient === "homo") {
      // Homosexual: buscar mismo sexo + homosexual
      pool = state.players.filter(
        p => p.gender === actor.gender && p.orient === "homo" && p.name !== actor.name
      );
      // Si no hay otro homosexual, comportarse como hetero (sexo opuesto)
      if (pool.length === 0) {
        const targetGenders = actor.gender === "M" ? ["F"] : ["M"];
        pool = state.players.filter(p => targetGenders.includes(p.gender) && p.name !== actor.name);
      }

    } else { // bi
      // Bisexual: cualquier sexo (M o F)
      pool = state.players.filter(p => p.name !== actor.name);
    }

    // Si no hay nadie v√°lido, pi√±ata: cualquiera menos el actor
    if (pool.length === 0) {
      pool = state.players.filter(p => p.name !== actor.name);
    }
    return pool[(Math.random()*pool.length)|0];
  }

  function interpolateNames(text, actor){
    return text
      .replace(/{{ACTOR}}/g, actor.name)
      .replace(/{{ALGUIEN}}/g, pickPartnerForActor(actor).name);
  }

  function nextChallenge(){
    const lvl=currentLevel();
    const all=RETOS.map((r,idx)=>Object.assign({idx},r));
    let pool=all.filter(r=>r.nivel===lvl && !state.usedByLevel[lvl].includes(r.idx));
    if(pool.length===0){ state.usedByLevel[lvl]=[]; pool=all.filter(r=>r.nivel===lvl); }
    const pick=pool[(Math.random()*pool.length)|0];
    state.usedByLevel[lvl].push(pick.idx);

    // Actor aleatorio
    const actor = state.players[(Math.random()*state.players.length)|0];

    $("chTitle").textContent = pick.titulo || "Reto";
    $("chText").textContent  = interpolateNames(pick.reto || "", actor);
    $("chNote").textContent  = pick.nota ? ("Nota: "+pick.nota) : "";
    $("challengeBox").style.display="block";
    nextRoundCounters();
  }

  // === Bindings
  $("numPlayers").addEventListener("change",renderPlayersConfigurator);
  $("shuffle").addEventListener("click",()=>{
    const n = parseInt($("numPlayers").value,10);
    const pool = ["Ella","Pareja","Bull","Amiga","Amigo","Invitado","X1","X2","X3"];
    for(let i=0;i<n;i++){ $("pname_"+i).value = pool[(Math.random()*pool.length)|0]; }
    toast("üîÄ Nombres aleatorizados");
  });
  $("start").addEventListener("click",()=>{
    collectPlayers(); if(state.players.length<2){toast("M√≠nimo 2 jugadores");return;}
    $("setup").style.display="none"; $("game").style.display="block";
    listPlayers(); resetGame(); toast("‚úÖ ¬°Partida iniciada!");
  });
  $("next").addEventListener("click",nextChallenge);
  $("skip").addEventListener("click",nextChallenge);
  $("reset").addEventListener("click",()=>{resetGame();toast("üîÑ Reiniciado")});
  $("backToSetup").addEventListener("click",()=>{$("game").style.display="none";$("setup").style.display="block";toast("‚Ü©Ô∏è Inicio")});
  $("incLvl").addEventListener("click",()=>setLevel(state.levelIndex+1));
  $("decLvl").addEventListener("click",()=>setLevel(state.levelIndex-1));

  // init
  renderPlayersConfigurator(); setLevel(0);
});
</script>
</body>
</html>
