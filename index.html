<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego de Retos â€¢ Trio</title>
<style>
  :root { --bg:#0b0c10; --card:#111318; --ink:#f3f5f7; --muted:#a9b2be; --accent:#7c4dff; }
  * { box-sizing:border-box }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial; background:var(--bg); color:var(--ink) }
  header { position:sticky; top:0; background:linear-gradient(180deg, rgba(11,12,16,.95), rgba(11,12,16,.75)); backdrop-filter:blur(6px); padding:12px 16px; border-bottom:1px solid #1d2026; display:flex; gap:8px; flex-wrap:wrap }
  .chip { padding:6px 10px; border-radius:999px; background:#1b1f26; border:1px solid #272b33; color:var(--muted); font-size:12px }
  .lvl { font-weight:700 }
  .wrap { max-width:980px; margin:0 auto; padding:16px }
  .card { background:#111318; border:1px solid #1d2026; border-radius:16px; padding:16px }
  h1 { font-size:18px; margin:0 }
  h2 { font-size:16px; margin:0 0 10px; color:var(--muted) }
  label { display:block; margin:10px 0 6px; color:var(--muted) }
  input, select, button, textarea { width:100%; padding:12px 14px; border-radius:12px; border:1px solid #282c34; background:#151820; color:var(--ink) }
  textarea { min-height:120px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; resize:vertical }
  button { background:var(--accent); border-color:transparent; font-weight:700; cursor:pointer }
  button.secondary { background:#1d2230; border:1px solid #2e3444; font-weight:600 }
  .row { display:grid; grid-template-columns:1fr 1fr; gap:12px }
  .row3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px }
  .pill { border-radius:999px; padding:4px 10px; background:#1c2030; border:1px solid #2a3042; color:#a9b2be; font-size:12px; display:inline-block; margin-right:6px }
  .challenge { margin-top:14px; padding:14px; background:#0f1117; border:1px dashed #2a3042; border-radius:12px }
  .gridPlayers { display:grid; grid-template-columns:repeat(2,1fr); gap:8px }
  .gridPlayers .card { padding:12px }
  .footer { color:#a9b2be; font-size:12px; text-align:center; padding:14px }
  .toast { position:fixed; bottom:14px; left:50%; transform:translateX(-50%); background:#1d2230; border:1px solid #2e3444; color:#fff; padding:8px 12px; border-radius:10px; font-size:12px; display:none; z-index:10 }
  .muted { color:#a9b2be; font-size:12px }
  details summary { cursor:pointer; margin:8px 0; color:#d3d8e0 }
</style>
</head>
<body>
  <header>
    <button id="decLvl" class="secondary" type="button">â—€ï¸Ž</button>
    <div class="chip">Nivel: <span id="lvl" class="lvl">BAJO</span></div>
    <button id="incLvl" class="secondary" type="button">â–¶ï¸Ž</button>
    <div class="chip">Ronda: <span id="round">0</span>/30</div>
    <div class="chip">Fase: <span id="phase">1/3</span></div>
  </header>

  <div class="wrap">
    <div class="card" id="setup">
      <h1>Configurar partida</h1>
      <label>NÃºmero de jugadores</label>
      <select id="numPlayers">
        <option>2</option><option selected>3</option><option>4</option><option>5</option><option>6</option>
      </select>

      <div id="playersCfg" class="gridPlayers" style="margin-top:12px;"></div>

      <details>
        <summary>Modo personalizado (pegar listas de retos por nivel)</summary>
        <p class="muted">Escribe <b>un reto por lÃ­nea</b>. Puedes usar los comodines <code>{{ACTOR}}</code> y <code>{{ALGUIEN}}</code>. Nada se sube, todo queda local en este archivo/navegador.</p>
        <label>BAJO (30 lÃ­neas)</label>
        <textarea id="taLow" placeholder="Ej: {{ACTOR}} acaricia el brazo de {{ALGUIEN}} sobre la ropa."></textarea>
        <label>MEDIO (30 lÃ­neas)</label>
        <textarea id="taMid" placeholder="Ej: {{ACTOR}} rodea la cintura de {{ALGUIEN}} y marca el ritmo 10 seg."></textarea>
        <label>ALTO (30 lÃ­neas)</label>
        <textarea id="taHigh" placeholder="Ej: (AquÃ­ puedes pegar tu lista intensa)."></textarea>
        <div class="row" style="margin-top:10px;">
          <button id="useCustom" class="secondary" type="button">Usar listas pegadas</button>
          <button id="clearCustom" class="secondary" type="button">Volver a listas por defecto</button>
        </div>
      </details>

      <div class="row" style="margin-top:12px;">
        <button id="start" type="button">Iniciar (Nivel BAJO)</button>
        <button id="shuffle" class="secondary" type="button">Aleatorizar Nombres</button>
      </div>
      <p class="muted" style="margin-top:10px">
        Reglas: Hetero â†’ sexo opuesto. Homosexual â†’ mismo sexo con homosexual; si no hay, actÃºa como hetero. Bisexual â†’ cualquiera.
      </p>
    </div>

    <div class="card" id="game" style="display:none;">
      <div class="row3">
        <div>
          <h2>Participantes</h2>
          <div id="playersList"></div>
        </div>
        <div>
          <h2>Control</h2>
          <div class="row">
            <button id="next" class="big" type="button">ðŸŽ² Sacar reto</button>
            <button id="skip" class="secondary" type="button">Saltar</button>
          </div>
          <div class="row" style="margin-top:10px;">
            <button id="reset" class="secondary" type="button">Reiniciar</button>
            <button id="backToSetup" class="secondary" type="button">Volver a Inicio</button>
          </div>
        </div>
        <div>
          <h2>Progreso</h2>
          <div class="pill">Nivel: <span id="lvl2">BAJO</span></div>
          <div class="pill">Ronda nivel: <span id="round2">0</span>/30</div>
          <div class="pill">Total retos: <span id="total">0</span></div>
        </div>
      </div>

      <div class="challenge" id="challengeBox" style="display:none;">
        <div class="muted">TÃ­tulo</div>
        <div id="chTitle" class="title"></div>
        <div class="muted" style="margin-top:8px">Reto</div>
        <div id="chText" class="big"></div>
        <div id="chNote" class="muted" style="margin-top:8px"></div>
      </div>
    </div>
    <div class="footer">Juego de Retos â€¢ v2.0 (listas personalizables)</div>
  </div>

  <div id="toast" class="toast"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const toast = (msg) => {
    const el = document.getElementById('toast');
    el.innerText = msg; el.style.display='block';
    setTimeout(()=>{ el.style.display='none'; }, 1200);
  };

  /* ========= RETOS POR DEFECTO (seguros) =========
     Puedes reemplazarlos pegando tus listas en el panel "Modo personalizado".
     Usa {{ACTOR}} y {{ALGUIEN}} para insertar nombres automÃ¡ticamente.
  */
  const SAFE_DEFAULTS = {
    BAJO: [
      "{{ACTOR}} acaricia suavemente el brazo de {{ALGUIEN}} sobre la ropa.",
      "{{ACTOR}} roza la mano de {{ALGUIEN}} y la sostiene 5 seg.",
      "{{ACTOR}} da un beso corto en la mejilla de {{ALGUIEN}}.",
      "{{ACTOR}} susurra algo cariÃ±oso al oÃ­do de {{ALGUIEN}}.",
      "{{ACTOR}} besa la frente de {{ALGUIEN}}.",
      "{{ACTOR}} acomoda el cabello de {{ALGUIEN}} rozando su rostro.",
      "{{ACTOR}} roza la nariz con la de {{ALGUIEN}} (media luna).",
      "{{ACTOR}} pasa la mano por la espalda de {{ALGUIEN}} sobre la ropa.",
      "{{ACTOR}} acaricia la rodilla de {{ALGUIEN}} 3 seg (ropa).",
      "{{ACTOR}} besa detrÃ¡s de la oreja de {{ALGUIEN}}.",
      "{{ACTOR}} le da un beso en la sien a {{ALGUIEN}}.",
      "{{ACTOR}} apoya su frente contra la de {{ALGUIEN}} 3 seg.",
      "{{ACTOR}} da un beso en la mano de {{ALGUIEN}}.",
      "{{ACTOR}} huele el cuello de {{ALGUIEN}} sin tocar.",
      "{{ACTOR}} se sienta muy pegado a {{ALGUIEN}} 10 seg.",
      "{{ACTOR}} acaricia el muslo de {{ALGUIEN}} suavemente (ropa).",
      "{{ACTOR}} roza las pestaÃ±as en la mejilla de {{ALGUIEN}}.",
      "{{ACTOR}} acaricia la espalda baja de {{ALGUIEN}} sobre la ropa.",
      "{{ACTOR}} baila lentamente pegado a {{ALGUIEN}} 10 seg.",
      "{{ACTOR}} besa suavemente la comisura de {{ALGUIEN}} sin tocar labios.",
      "{{ACTOR}} da un beso corto en el hombro de {{ALGUIEN}}.",
      "{{ACTOR}} acaricia el cuello de {{ALGUIEN}} con un dedo.",
      "{{ACTOR}} toma la cintura de {{ALGUIEN}} y lo acerca 3 seg.",
      "{{ACTOR}} da un cumplido a {{ALGUIEN}} al oÃ­do.",
      "{{ACTOR}} acaricia la mandÃ­bula de {{ALGUIEN}} con la mano.",
      "{{ACTOR}} guÃ­a a {{ALGUIEN}} de la mano y da 3 pasos.",
      "{{ACTOR}} apoya su hombro con el de {{ALGUIEN}} 5 seg.",
      "{{ACTOR}} dibuja una figura en la mano de {{ALGUIEN}} con un dedo.",
      "{{ACTOR}} hace reÃ­r a {{ALGUIEN}} con una frase pÃ­cara pero amable.",
      "{{ACTOR}} brinda con {{ALGUIEN}} y le dice quÃ© le atrae de Ã©l/ella."
    ],
    MEDIO: [
      "{{ACTOR}} pos(a) la mano en el muslo interno de {{ALGUIEN}} (ropa).",
      "{{ACTOR}} masajea la nuca de {{ALGUIEN}} 15 seg.",
      "{{ACTOR}} besa el cuello de {{ALGUIEN}} 5 seg.",
      "{{ACTOR}} rodea la cintura de {{ALGUIEN}} y marca un ritmo suave.",
      "{{ACTOR}} se sienta en el regazo de {{ALGUIEN}} 10 seg.",
      "{{ACTOR}} abre un botÃ³n superficial o baja un cierre 2 cm a {{ALGUIEN}}.",
      "{{ACTOR}} acerca su boca a la comisura de {{ALGUIEN}} sin besar 2 seg.",
      "{{ACTOR}} recorre el costado del torso de {{ALGUIEN}} (ropa) lentamente.",
      "{{ACTOR}} besa un hombro de {{ALGUIEN}} descubierto.",
      "{{ACTOR}} confiesa a {{ALGUIEN}} una fantasÃ­a breve (no grÃ¡fica).",
      "{{ACTOR}} guÃ­a con su mano la espalda baja de {{ALGUIEN}} al caminar.",
      "{{ACTOR}} masajea hombros de {{ALGUIEN}} 15 seg.",
      "{{ALGUIEN}} coloca la mano de {{ACTOR}} en su cintura 5 seg.",
      "{{ACTOR}} toma las manos de {{ALGUIEN}} y las lleva a su pecho (ropa).",
      "{{ACTOR}} acaricia la cadera de {{ALGUIEN}} 5 seg (ropa).",
      "{{ACTOR}} descubre un hombro de {{ALGUIEN}} y lo besa una vez.",
      "{{ACTOR}} desliza la mano desde el dorso hasta la cintura de {{ALGUIEN}}.",
      "{{ACTOR}} se sienta apegado a {{ALGUIEN}} y apoya su cabeza en su hombro.",
      "{{ACTOR}} repite al oÃ­do de {{ALGUIEN}} lo que quiera oÃ­r, muy cerca.",
      "{{ACTOR}} deja dos besos en el cuello de {{ALGUIEN}} con pausa.",
      "{{ACTOR}} toma las caderas de {{ALGUIEN}} y marca un ritmo 10 seg.",
      "{{ACTOR}} gira a {{ALGUIEN}} tomÃ¡ndolo de la cintura y lo acerca al pecho.",
      "{{ACTOR}} acaricia suavemente la parte baja de la espalda (bajo ropa) de {{ALGUIEN}}.",
      "{{ACTOR}} acaricia el muslo de {{ALGUIEN}} subiendo un poco (ropa).",
      "{{ACTOR}} sopla aire tibio al cuello de {{ALGUIEN}} y lo roza con labios sin besar.",
      "{{ACTOR}} besa la clavÃ­cula de {{ALGUIEN}} con la ropa apartada.",
      "{{ACTOR}} camina detrÃ¡s de {{ALGUIEN}} con ambas manos en su cintura 5 seg.",
      "{{ACTOR}} se sienta de espaldas a {{ALGUIEN}} entre sus piernas 10 seg.",
      "{{ACTOR}} roza el lÃ³bulo de la oreja de {{ALGUIEN}} con un beso suave.",
      "{{ACTOR}} acerca sus labios a 1 cm de los de {{ALGUIEN}} 3 seg sin tocar."
    ],
    ALTO: [
      // Alto por defecto, manteniendo un lenguaje no explÃ­cito
      "{{ACTOR}} da un beso en los labios de {{ALGUIEN}} (consentido, breve).",
      "{{ACTOR}} besa lentamente el cuello de {{ALGUIEN}}.",
      "{{ACTOR}} baila muy pegado con {{ALGUIEN}} 20 seg marcando caderas.",
      "{{ACTOR}} sostiene el rostro de {{ALGUIEN}} con ambas manos y lo besa.",
      "{{ACTOR}} se sienta en el regazo de {{ALGUIEN}} mirando a los ojos 10 seg.",
      "{{ACTOR}} besa la lÃ­nea de la mandÃ­bula de {{ALGUIEN}}.",
      "{{ACTOR}} acerca su pecho al de {{ALGUIEN}} y respiran juntos 5 seg.",
      "{{ACTOR}} sujeta las caderas de {{ALGUIEN}} y marca un ritmo 10 seg.",
      "{{ACTOR}} besa frente, mejilla, mejilla y comisura de {{ALGUIEN}}.",
      "{{ACTOR}} pide a {{ALGUIEN}} cerrar los ojos y da un beso suave.",
      "{{ACTOR}} besa la piel descubierta de la espalda de {{ALGUIEN}}.",
      "{{ACTOR}} apoya una rodilla entre las piernas de {{ALGUIEN}} (suave, ropa).",
      "{{ACTOR}} da un beso prolongado a {{ALGUIEN}} (3â€“5 seg).",
      "{{ACTOR}} besa el hombro y luego la comisura de {{ALGUIEN}}.",
      "{{ACTOR}} se sienta de espaldas a {{ALGUIEN}} entre sus piernas 10 seg.",
      "{{ACTOR}} roza su nariz con la de {{ALGUIEN}} y besa su comisura.",
      "{{ACTOR}} acerca a {{ALGUIEN}} de la cintura y lo mantiene cerca 5 seg.",
      "{{ACTOR}} besa a {{ALGUIEN}}, hace una pausa y vuelve a besar.",
      "{{ACTOR}} invita a un tercero a colocarse cerca, todos muy juntos 10 seg.",
      "{{ACTOR}} besa a {{ALGUIEN}} y mira al tercero con picardÃ­a (sugerente).",
      "{{ACTOR}} toma una mano de {{ALGUIEN}} y la lleva a su pecho (sobre ropa).",
      "{{ACTOR}} da una vuelta pegada a {{ALGUIEN}} sujetando su cintura.",
      "{{ACTOR}} besa con intenciÃ³n pero corto a {{ALGUIEN}}.",
      "{{ACTOR}} describe a {{ALGUIEN}} una idea para luego (no grÃ¡fica).",
      "{{ACTOR}} coloca sus manos en la cadera de {{ALGUIEN}} y guÃ­a 10 seg.",
      "{{ACTOR}} apoya la frente con la de {{ALGUIEN}} y lo besa enseguida.",
      "{{ACTOR}} besa la base del cuello de {{ALGUIEN}} lentamente.",
      "{{ACTOR}} coloca a {{ALGUIEN}} entre sus brazos y acerca sus cuerpos 10 seg.",
      "{{ACTOR}} da un beso final con pausa y mirada.",
      "{{ACTOR}} comparte con {{ALGUIEN}} quÃ© imagen se lleva del momento."
    ]
  };

  const LEVELS = ["BAJO","MEDIO","ALTO"];
  const $ = (id) => document.getElementById(id);

  let RETOS = JSON.parse(JSON.stringify(SAFE_DEFAULTS)); // copia
  let state = {
    levelIndex:0, roundInLevel:0, totalRounds:0,
    players:[], // {name, gender:'M'|'F', orient:'hetero'|'homo'|'bi'}
    usedByLevel:{BAJO:[],MEDIO:[],ALTO:[]},
    inGame:false
  };

  const currentLevel = () => LEVELS[state.levelIndex];

  function syncUI() {
    $("lvl").textContent = currentLevel();
    $("lvl2").textContent = currentLevel();
    $("phase").textContent = (state.levelIndex+1)+"/3";
    $("round").textContent = state.roundInLevel;
    $("round2").textContent = state.roundInLevel;
    $("total").textContent = state.totalRounds;
    $("start").textContent = `Iniciar (Nivel ${currentLevel()})`;
  }

  function setLevel(idx, {manual=false} = {}){
    const clamped = Math.max(0, Math.min(2, idx));
    if (clamped !== state.levelIndex) {
      state.levelIndex = clamped;
      state.roundInLevel = 0;
      state.usedByLevel[ currentLevel() ] = state.usedByLevel[ currentLevel() ] || [];
      syncUI();
      if (manual) toast(`Nivel cambiado a ${currentLevel()}`);
    } else {
      syncUI();
    }
  }

  function nextRoundCounters(){
    state.roundInLevel++; state.totalRounds++;
    if(state.roundInLevel>=30 && state.levelIndex<2){
      state.roundInLevel=0; state.levelIndex++; toast("â¤´ï¸ Cambio de nivel automÃ¡tico");
    }
    syncUI();
  }

  function resetGame(){
    state.roundInLevel=0; state.totalRounds=0; state.inGame=false;
    state.usedByLevel={BAJO:[],MEDIO:[],ALTO:[]};
    setLevel(0); $("challengeBox").style.display="none";
  }

  // === UI de jugadores (con ORIENTACIÃ“N) ===
  function renderPlayersConfigurator(){
    const n = parseInt($("numPlayers").value,10);
    const root = $("playersCfg"); root.innerHTML="";
    const defaults = ["Ella","Pareja","Bull","Amiga","Amigo","Invitado"];
    for(let i=0;i<n;i++){
      const c = document.createElement("div"); c.className="card";
      c.innerHTML = `
        <label>Jugador ${i+1}</label>
        <input type="text" id="pname_${i}" value="${defaults[i%defaults.length]}">
        <label>GÃ©nero</label>
        <select id="pg_${i}">
          <option value="M">Hombre</option>
          <option value="F" ${i===0?"selected":""}>Mujer</option>
        </select>
        <label>OrientaciÃ³n</label>
        <select id="po_${i}">
          <option value="hetero">Hetero</option>
          <option value="homo">Homosexual</option>
          <option value="bi">Bisexual</option>
        </select>
      `;
      root.appendChild(c);
    }
  }

  function collectPlayers(){
    const n = parseInt($("numPlayers").value,10);
    state.players = [];
    for(let i=0;i<n;i++){
      const name = $("pname_"+i).value.trim() || ("J"+(i+1));
      const gender = $("pg_"+i).value;
      const orient = $("po_"+i).value;
      state.players.push({ name, gender, orient });
    }
  }

  function listPlayers(){
    const root=$("playersList"); root.innerHTML="";
    const ul=document.createElement("ul"); ul.style.margin="0"; ul.style.paddingLeft="18px";
    const gtxt = g => g==="M"?"Hombre":"Mujer";
    const otxt = o => o==="hetero"?"Hetero":o==="homo"?"Homosexual":"Bisexual";
    state.players.forEach(p=>{
      const li=document.createElement("li");
      li.textContent=`${p.name} â€¢ ${gtxt(p.gender)} â€¢ ${otxt(p.orient)}`;
      ul.appendChild(li);
    });
    root.appendChild(ul);
  }

  // === Compatibilidad gÃ©nero + orientaciÃ³n del ACTOR ===
  // Homo: si no hay otro homo del mismo sexo â†’ actÃºa como hetero.
  function pickPartnerForActor(actor){
    let pool = [];

    if (actor.orient === "hetero") {
      const targets = actor.gender === "M" ? ["F"] : ["M"];
      pool = state.players.filter(p => targets.includes(p.gender) && p.name !== actor.name);

    } else if (actor.orient === "homo") {
      pool = state.players.filter(
        p => p.gender === actor.gender && p.orient === "homo" && p.name !== actor.name
      );
      if (pool.length === 0) {
        const targets = actor.gender === "M" ? ["F"] : ["M"];
        pool = state.players.filter(p => targets.includes(p.gender) && p.name !== actor.name);
      }

    } else { // bi
      pool = state.players.filter(p => p.name !== actor.name);
    }

    if (pool.length === 0) pool = state.players.filter(p => p.name !== actor.name);
    return pool[(Math.random()*pool.length)|0];
  }

  function renderText(text, actor){
    return text
      .replace(/{{ACTOR}}/g, actor.name)
      .replace(/{{ALGUIEN}}/g, pickPartnerForActor(actor).name);
  }

  function nextChallenge(){
    const lvl = currentLevel();
    const allLines = (RETOS[lvl] || []).map((t,idx)=>({ idx, text: t }));
    if (allLines.length === 0) { toast("No hay retos en este nivel"); return; }

    let available = allLines.filter(r => !state.usedByLevel[lvl].includes(r.idx));
    if (available.length === 0) { state.usedByLevel[lvl] = []; available = allLines; }

    const pick = available[(Math.random()*available.length)|0];
    state.usedByLevel[lvl].push(pick.idx);

    const actor = state.players[(Math.random()*state.players.length)|0];

    document.getElementById("chTitle").textContent = `Nivel ${lvl}`;
    document.getElementById("chText").textContent  = renderText(pick.text || "", actor);
    document.getElementById("chNote").textContent  = "";
    document.getElementById("challengeBox").style.display="block";

    nextRoundCounters();
  }

  // === PersonalizaciÃ³n: pegar listas ===
  function parseTextareaLines(id){
    const raw = document.getElementById(id).value || "";
    return raw.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  }
  function applyCustomLists(){
    const low = parseTextareaLines("taLow");
    const mid = parseTextareaLines("taMid");
    const high = parseTextareaLines("taHigh");
    const next = { BAJO: low.length?low:SAFE_DEFAULTS.BAJO,
                   MEDIO: mid.length?mid:SAFE_DEFAULTS.MEDIO,
                   ALTO: high.length?high:SAFE_DEFAULTS.ALTO };
    RETOS = next;
    state.usedByLevel={BAJO:[],MEDIO:[],ALTO:[]};
    toast("âœ… Listas aplicadas");
  }
  function clearCustomLists(){
    $("taLow").value = $("taMid").value = $("taHigh").value = "";
    RETOS = JSON.parse(JSON.stringify(SAFE_DEFAULTS));
    state.usedByLevel={BAJO:[],MEDIO:[],ALTO:[]};
    toast("ðŸ”„ Vuelves a las listas por defecto");
  }

  // === Bindings
  $("numPlayers").addEventListener("change",renderPlayersConfigurator);
  $("shuffle").addEventListener("click",()=>{
    const n = parseInt($("numPlayers").value,10);
    const pool = ["Ella","Pareja","Bull","Amiga","Amigo","Invitado","X1","X2","X3"];
    for(let i=0;i<n;i++){ $("pname_"+i).value = pool[(Math.random()*pool.length)|0]; }
    toast("ðŸ”€ Nombres aleatorizados");
  });

  $("useCustom").addEventListener("click", applyCustomLists);
  $("clearCustom").addEventListener("click", clearCustomLists);

  $("start").addEventListener("click",()=>{
    collectPlayers(); if(state.players.length<2){toast("MÃ­nimo 2 jugadores");return;}
    document.getElementById("setup").style.display="none";
    document.getElementById("game").style.display="block";
    listPlayers(); resetGame(); // inicia en BAJO por diseÃ±o de 3 fases
    toast(`âœ… Â¡Partida iniciada! Nivel ${currentLevel()}`);
  });

  $("next").addEventListener("click",nextChallenge);
  $("skip").addEventListener("click",nextChallenge);
  $("reset").addEventListener("click",()=>{ resetGame(); toast("ðŸ”„ Reiniciado"); });
  $("backToSetup").addEventListener("click",()=>{
    document.getElementById("game").style.display="none";
    document.getElementById("setup").style.display="block";
    syncUI();
    toast("â†©ï¸ Inicio");
  });

  $("incLvl").addEventListener("click",()=> setLevel(state.levelIndex+1, {manual:true}));
  $("decLvl").addEventListener("click",()=> setLevel(state.levelIndex-1, {manual:true}));

  // init
  renderPlayersConfigurator();
  syncUI();
});
</script>
</body>
</html>
